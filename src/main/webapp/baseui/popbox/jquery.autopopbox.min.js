(function(b,c){var a=function(e,d){this.initialize("autopopbox",e,d)};a.prototype=b.extend({},b.fn.popbox.Constructor.prototype,{constructor:a,getPosition:function(){var e=null;var f=this;var d=function(g){switch(g){case"leftRightAuto":e=f._setPosLeftRightAuto();break;case"topBottomAuto":e=f._setPosTopBottomAuto();break;default:}return e};if(typeof this.options.direction=="string"){e=d(this.options.direction)}return e},_getClientPos:function(){var j=this.getWindowInfo();var d=this.$element[0].getClientRects?this.$element[0].getClientRects():null;if(this.options.eventObj&&(d&&d.length>1)){var f=d[0]["bottom"],h=d[1]["bottom"];var g=h-f;var k=this.options.eventObj.pageY;var e=0;while(k>=d[e]["bottom"]+j.winST){e=e+1}return{popBoxTargetT:d[e]["top"]+j.winST,popBoxTargetL:d[e]["left"]+j.winSL,popBoxTargetW:d[e]["right"]-d[e]["left"],popBoxTargetH:g}}else{return{}}},_setPosTopBottomAuto:function(){var f=b.extend({},this.getPosInfo(),this._getClientPos()),l=this.getWindowInfo(),d=f.popBoxTargetT-l.winST>=f.popBoxOutH?"top":"bottom",j=l.winW-f.popBoxTargetL+l.winSL>=f.popBoxOutW?["left","L"]:["right","R"];var h=d=="top"?(f.popBoxTargetT-f.popBoxOutH):(f.popBoxTargetT+f.popBoxTargetH);var k=j[0]=="left"?f.popBoxTargetL:(f.popBoxTargetL-f.popBoxOutW+f.popBoxTargetW);var e=d=="top"?(h-this.options.offset):(h+this.options.offset);var i=k;var g="";if(h>f.popBoxTargetT){g="bottom"+j[1]}else{g="top"+j[1]}this.$popWarp.removeClass("angle_topL angle_topR angle_bottomL angle_bottomR").addClass("angle_"+g);this.$popLayer.removeClass("layer_topL layer_topR layer_bottomL layer_bottomR").addClass("layer_"+g);return{popBoxOffsetT:e,popBoxOffsetL:i,popBoxT:h,popBoxL:k}},_setPosLeftRightAuto:function(){var f=this.getPosInfo(),l=this.getWindowInfo(),d=l.winH+l.winST-f.popBoxTargetT>=f.popBoxOutH?["bottom","T"]:["top","B"],j=l.winW+l.winSL-(f.popBoxTargetL+f.popBoxTargetW)>=f.popBoxOutW?"right":"left";var h=d[0]=="bottom"?f.popBoxTargetT:f.popBoxTargetT+f.popBoxTargetH-f.popBoxOutH;var k=j=="right"?(f.popBoxTargetL+f.popBoxTargetW):f.popBoxTargetL-f.popBoxOutW;var e=h;var i=j=="right"?(k+this.options.offset):(k-this.options.offset);var g="";if(k>f.popBoxTargetL){g="right"+d[1]}else{g="left"+d[1]}this.$popWarp.removeClass("angle_leftT angle_leftB angle_rightT angle_rightB").addClass("angle_"+g);this.$popLayer.removeClass("layer_leftT layer_leftB layer_rightT layer_rightB").addClass("layer_"+g);return{popBoxOffsetT:e,popBoxOffsetL:i,popBoxT:h,popBoxL:k}}});b.fn.autopopbox=function(f){var g=[];for(var e=0,d=arguments.length;e<d;e++){g.push(arguments[e])}var h=g.slice(1);return this.each(function(){var k=b(this),j=k.data("autopopbox"),i=typeof f=="object"&&f;if(!j){j=new a(this,i);k.data("autopopbox",j)}else{if(typeof f=="object"){j.setOptions({eventObj:f.eventObj});j.setPos(j.getPosition())}}if(typeof g[0]=="string"){j[g[0]].apply(j,h)}})};b.fn.autopopbox.Constructor=a;b.fn.autopopbox.defaults=b.extend({},b.fn.popbox.defaults,{direction:"topBottomAuto"})})(window.jQuery);